:jbake-type: documentation
:jbake-tags: projects, jlangdetect, deck2pdf, teamcity, jbake, groovy
:jbake-status: published

:icons: font
:iconfont-remote!:
:linkattrs


= Documentation

== What is it?

*AjaxAnywhere (reloaded)* is an *Open Source* declarative Ajax framework for the JVM. It enables the developer to *provide async server side rendering and page refresh without Javascript coding*.

This library is a fork of the ancient and abandoned http://ajaxanywhere.sourceforge.net/[AjaxAnywhere^] library hosted in
SourceForge to add new features like:

* Declarative programming style via HTML5 custom elements markup.
* *The developer does not need to write any Javascript code.* You just
need to include the AjaxAnywhere Javascript file in your page and it
will do the rest for you!!
* AjaxAnywhere client side javascript code now *relies on jQuery* to implement all
the required features.
* Code base refactored aiming for simplification and speed.
* There are no external Java dependencies.
* HTML parsing implementation does not rely on the Java SE HTML anymore. In fact no HTML parser is used now. Just plain old String.substring method is used.
* JSF support has been dropped, because a similar but more cumbersome idea is already built-in within http://java.dzone.com/articles/ajax-jsf-joined[the JSF spec since version 2.0^].

*AjaxAnywhere continues to be a PAGE or PAGE FRAGMENT oriented
framework* and not a component framework. So don’t expect to find "yet
another autocomplete component".

You can see didactic working
*http://examples.ajaxanywhere.com[EXAMPLES HERE^]*.

== How does it work?

The idea is really simple:

1.  Mark the zones to refresh in you JSP template.
2.  Add special `aa-refresh-zones` on all action trigger elements that you want to "ajaxify" like: forms, submit buttons, input images or even normal links.
3.  You can develop your server code as if you were implementing the
classic "synchronous" approach.
4.  AjaxAnywhere servlet filter will intercept the Ajax request and
extract the content that needs to be refreshed from the response. The
"refresh zones" contents will be put in XML back to the client +
5.  AjaxAnywhere Javascript is responsible for parsing the XML and
inserting the content in the page.

The following picture and diagram may help to visualize it:

[.float-group]
--
[.left.thumbnail-next]
image::img/aa-image1.png[alt="\"Ajaxified\" form with AjaxAnywhere", 410, class="thumbnail", caption="Figure 1 - ", title="\"Ajaxified\" form with AjaxAnywhere", class="thumbnail", link="img/aa-image1.png"]

[.left.thumbnail-next]
image::img/aa-image2.png[alt="AjaxAnywhere request life cycle", 381, caption="Figure 2 - ", title="AjaxAnywhere request life cycle", link="img/aa-image2.png"]
--

== Usage

=== Generic Installation

[#coordinates]
* Add the AjaxAnywhere library dependency:

[source,xml]
----
<dependency>
  <groupId>com.nerderg.ajaxanywhere</groupId>
  <artifactId>ajaxanywhere</artifactId>
  <version>2.1</version>
</dependency>
----

* Register the AjaxAnywhere filter in your *web.xml*: it is important to
  register this filter before any other filter that is likely to modify
  the response content (e.g Sitemesh, …):

[source,xml]
----
<filter>
    <filter-name>AjaxAnywhere</filter-name>
    <filter-class>com.nerderg.ajaxanywhere.AAFilter</filter-class>
</filter>

<filter-mapping>
    <filter-name>AjaxAnywhere</filter-name>
    <servlet-name>MyServlet</servlet-name>
</filter-mapping>
----

* Import jQuery (1.7+) and AjaxAnywhere Javascript libraries (example):

[source,html]
----
<script src="<c:url value="/webjars/jquery/1.11.2/jquery.min.js"/>"></script>
<script src="<c:url value="/webjars/ajaxanywhere/2.1/aa.js"/>"></script>
----

* You can also add a javascript dependency with the http://foliotek.github.io/AjaxQ/[AjaxQ library^] to enable the queueing features (example):

[source,html]
----
<script src="<c:url value="/webjars/AjaxQ/0.0.2/ajaxq.js"/>"></script>
----

WARNING: Queueing feature only available since *version 2.1*

* If you are using a *noncompliant Servlet 3.x* Application Server (like Tomcat 6.x), then you need to register the http://www.webjars.org/documentation["Webjars servlet 2.x add-on"^].


NOTE: This is due to the fact that AjaxAnywhere is using the http://alexismp.wordpress.com/2010/04/28/web-inflib-jarmeta-infresources/[Servlet 3.0 mechanism to serve static resources from within a JAR file^] following the http://www.webjars.org[WebJars^] convention:

=== How to declare AjaxAnywhere triggers

These elements will trigger the partial page refresh when clicked. AjaxAnywhere defines the following HTML5 custom attributes to declare any "clickable" element as an *AjaxAnywhere trigger*:

[cols="2,1,5a", options="header", width="100%"]
|===
|Attribute (AA version)
|Mandatory
|Mission

|*aa-refresh-zones* (2.0)
|yes
|comma separated list with names of the "zones" you want to refresh.

|*aa-method* (2.1)
|no
|HTTP method: GET, POST, ... Form elements default this value to the form method attribute. For links the default is GET.

|*aa-js-before* (2.1)
|no
|javascript that will get evaluated before performing the ajax request. Eg: `aa-js-before="loadDynamicaParams();"`

|*aa-js-after* (2.1)
|no
|javascript that will get evaluated after performing the ajax request. Eg: `aa-js-before="openModalDialog();"`

|*aa-queue* (2.1)
|no
|AjaxQ lib is required for this feature. You would use it if multiple ajax requests have to be performed sequentially for the page refresh to be coherent.

These are the three possible values:

* *true*: to queue ajax request.
* *abort*: aborts previous ongoing request, and removes any unprocessed requests from the queue.
* *clear*: removes any unprocessed requests from the queue but lets finish previous ongoing request.

|*aa-href* (2.1)
|no
|contains the url to get the relevant content for those elements that unlike the form or links have no standard means to specify a url
|===

Next are the most common trigger examples which are usually associated with the *form*, *input*, *button*,*select* or *link/anchor* elements:

* *`<form … >`*: this will automatically "ajaxify" all the submits from
within the form
(http://examples.ajaxanywhere.com/#example2[working example^]):

[source,html,options="nowrap"]
----
<form action="${action}" method="post" aa-refresh-zones="aaZone1Example1, aaZone2Example1">
...
</form>
----

* *`<input type="submit" … >`, `<input type="image" … >`, `<button
type="submit" … >`*: this way you can specify more fine grained behavior
refresh zones depending upon the clicked button within a form.
(http://examples.ajaxanywhere.com/#example3[working example^]):


[source,html,options="nowrap"]
----
<form action="${action}" method="post">
...
  <div>
    <button type="submit" aa-refresh-zones="aaZone1Example2" class="btn btn-primary" name="refreshTextButton" value="Refresh Text">Refresh Text</button>
    <input type="image" aa-refresh-zones="aaZone1Example2" src="<c:url value='/img/refresh.png'/>" name="refreshTextButton" value="Refresh Text"/>
    <input type="submit" aa-refresh-zones="aaZone2Example2" class="btn btn-info" name="showCodeButton" value="Show Code"/>
  </div>
</form>
----

NOTE: The *refresh zones specified in a submit element will always
override those specified in the form*

* *`<select … >`*: you can also trigger an Ajax request when the selected
  value in a drop-down list changes:
  (http://examples.ajaxanywhere.com/#example4[working example^]):

[source,html,options="nowrap"]
----
<form action="${action}" method="post">
...
  <sf:select path="continentCode" aa-refresh-zones="countryZone, capitalZone" id="continentCode">
      <sf:option value="">-- Select One --</sf:option>
      <sf:options items="${countryForm.continentsSet}" itemLabel="value" itemValue="key"/>
  </sf:select>
...
</form>
----

* *`<a href="/url" … >`*: without requiring a form scope, *you can also
  "ajaxify" any link within your page*
  (http://examples.ajaxanywhere.com/#example5[working example^]):

[source,html,options="nowrap"]
----
<a href="<c:url value='/action/examples/4?data=whatever'/>" aa-refresh-zones="codeLayer4">Show Code</a>
----

=== Mark the 'refresh zones' in your page

It is as simple as: +

* declaring the AjaxAnywhere taglib in your JSP template:

[source,html,options="nowrap"]
----
<%@ taglib uri="http://com.nerderg/ajaxanywhere" prefix="aa" %>
----

* and embed the content you want to refresh within the AjaxAnywhere tag:

[source,html,options="nowrap"]
----
<aa:zone id="myZone">
  <!-- Zone Content -->
  ...
</aa:zone>
----

This by default will generate a `<div>` with some special markup:

[source,html,options="nowrap"]
----
<div style="display:inline;" id="myZone">

<!-- @end of zone [myZone]@ --></div>
----

=== New 'refresh zones' features
Since version 2.1 a few new use cases have been added to the way refresh zones are handled.

==== 1. Everything can be a "refresh zone"

TODO

==== 2. Auto refresh zone at page loading time

TODO

== F.A.Q.

==== Where can I download the library?
We highly recommend that you use a dependency manager like Maven, Gradle
or Apache Ivy and use the Maven coordinates explained
<<coordinates,above>>. But if you are stuck in an awful legacy
project and you want to make it look nicer with AjaxAnywhere, then you
can download the library from the
link:++https://oss.sonatype.org/index.html#nexus-search;gav~com.nerderg.ajaxanywhere~ajaxanywhere~2.0~jar~++[AjaxAnywhere
Maven repository hosted by Sonatype^].

==== How can I display a spinner or any other notification mechanism while the Ajax request is processed?
Since AjaxAnywhere delegates on jQuery to perform the Ajax request, you
just need to register an event handler using the
`link:http://api.jquery.com/ajaxStart/[jQuery ajaxStart()^]` method and
implement the behavior you want. Next there is an example that shows how
to do it:

++++
<script src="https://gist.github.com/aruizca/5139667.js"></script>
++++

==== Is there any way to identify an AjaxAnywhere Ajax request at server side?

Sure you can! In fact one very common use case in a controller is to
perform either a forward or a redirect depending on if it was an Ajax
request or not. AjaxAnywhere provides the static
*AAUtils.isAjaxAnywhereRequest(request)* method for your convenience:

++++
<script src="https://gist.github.com/aruizca/5139808.js"></script>
++++

==== What are the advantages of using AjaxAnywhere?
Just three words: *simplicity, productivity and maintainability*. For
most of the use cases that a developer can face, AjaxAnywhere is the
*easiest* and *most cost-effective* way to implement Ajax enabled web
applications. +

You can also implement AjaxAnywhere in your legacy projects without
making any change to your controller layer. It also makes it easier to
implement graceful degradation or continued enhancement to your UI so
you can meet you accessibility requirements without crippling the UX.

==== Are there any inconveniences?
Although AjaxAnywhere impact on response time is negligible for the vast
majority of use cases that we all developers have to deal with on daily
basis, but there could be certain scenarios where 10ms per request
must be taken into consideration.

==== I am still stuck in JDK 1.4, can I still use AjaxAnywhere?
We feel so sorry for you mate… what can we do? Oh yeah! we created a
profile in the AjaxAnywhere library pom file so you can download the
source code, and package your own JDK 1.4 compatible JAR. Once you pull
the code, execute the following Maven command in the AjaxAnywhere Core
folder (not the parent project folder):

----
mvn package -P1.4
----

==== What external dependencies does AjaxAnywhere have?
None whatsoever. You just need a JRE 5+ and a Servlet 2.3+ container. +
The application logging is performed with JUL (Java Util Logging). +
 +
At client side though you will need jQuery 1.7+, although *jQuery 1.9.x*
is recommended.

==== What if I want to bridge the JUL based traces to SLF4J?
AjaxAnywhere includes a ServletContextListener implementation to do
that. Just add it to your web.xml as follows: +

++++
<script src="https://gist.github.com/aruizca/5080373.js"></script>
++++
